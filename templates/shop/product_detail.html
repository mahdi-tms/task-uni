{% extends 'base.html' %}
{% load humanize %}
{% block title %}{{ product.name }} | فروشگاه{% endblock %}
{% block content %}
<nav class="text-sm text-slate-500 mb-4" aria-label="breadcrumb">
  <ol class="flex items-center gap-2">
    <li><a class="hover:text-emerald-600" href="/">خانه</a></li>
    <li>/</li>
    <li><a class="hover:text-emerald-600" href="{% url 'shop:product_list' %}?category={{ product.category.slug }}">{{ product.category.name }}</a></li>
    <li>/</li>
    <li class="text-slate-700">{{ product.name }}</li>
  </ol>
</nav>

<div class="grid lg:grid-cols-2 gap-10">
  <div>
    <div class="aspect-[4/5] rounded-3xl bg-white shadow-soft overflow-hidden relative">
      {% if product.image %}
        <img id="main-image" src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover transition">
      {% else %}
        <div class="w-full h-full bg-gradient-to-br from-slate-100 to-slate-200"></div>
      {% endif %}
      {% if product.compare_at_price %}
        <span class="absolute top-4 end-4 px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-sm">٪{{ product.discount_percent }} تخفیف</span>
      {% endif %}
    </div>
    <div class="mt-3 flex gap-3 overflow-x-auto" id="thumbs">
      {% if product.image %}
        <button class="thumb active border-2 border-emerald-500 rounded-2xl overflow-hidden" data-src="{{ product.image.url }}">
          <img src="{{ product.image.url }}" class="w-20 h-20 object-cover" alt="{{ product.name }}">
        </button>
      {% endif %}
      {% for img in product.gallery.all %}
        <button class="thumb border border-slate-200 rounded-2xl overflow-hidden" data-src="{{ img.image.url }}">
          <img src="{{ img.image.url }}" class="w-20 h-20 object-cover" alt="{{ img.alt_text|default:product.name }}">
        </button>
      {% endfor %}
    </div>
  </div>

  <div class="space-y-4">
    <div class="flex items-center gap-3 text-amber-500">
      <span class="text-lg">★</span><span class="font-semibold">{{ product.rating }}</span><span class="text-slate-500 text-sm">(امتیاز ساختگی)</span>
    </div>
    <h1 class="text-3xl font-bold text-slate-900">{{ product.name }}</h1>
    <p class="text-slate-600 leading-7">{{ product.description }}</p>
    <div class="flex items-center gap-3">
      <span class="text-3xl font-bold text-slate-900">{{ product.price|floatformat:0|intcomma }} تومان</span>
      {% if product.compare_at_price %}<span class="text-lg line-through text-slate-400">{{ product.compare_at_price|floatformat:0|intcomma }}</span>{% endif %}
    </div>
    <form action="{% url 'shop:add_to_cart' %}" method="post" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="product_id" value="{{ product.id }}">
      <div class="flex items-center gap-3">
        <label class="text-sm font-semibold text-slate-700">تعداد</label>
        <div class="inline-flex items-center rounded-xl border border-slate-200 overflow-hidden" data-qty>
          <button type="button" class="px-3 py-2 text-lg" data-qty-decrease>-</button>
          <input name="quantity" type="number" value="1" min="1" class="w-14 text-center border-x border-slate-200 focus:outline-none" />
          <button type="button" class="px-3 py-2 text-lg" data-qty-increase>+</button>
        </div>
      </div>
      <div class="flex flex-wrap gap-3">
        <button class="px-6 py-3 rounded-xl bg-gradient-to-l from-brand-500 to-emerald-500 text-white font-semibold shadow-soft">افزودن به سبد</button>
        <a href="{% url 'shop:cart' %}" class="px-6 py-3 rounded-xl border border-slate-200 text-slate-700">مشاهده سبد</a>
      </div>
    </form>

    <div class="divide-y divide-slate-200 border border-slate-200 rounded-2xl" id="accordion">
      <div class="p-4 cursor-pointer flex items-center justify-between" data-accordion-toggle>
        <span class="font-semibold">جزئیات محصول</span>
        <span>+</span>
      </div>
      <div class="p-4 text-sm text-slate-600 hidden" data-accordion-body>
        {{ product.description }}
      </div>
      <div class="p-4 cursor-pointer flex items-center justify-between" data-accordion-toggle>
        <span class="font-semibold">ارسال و تحویل</span>
        <span>+</span>
      </div>
      <div class="p-4 text-sm text-slate-600 hidden" data-accordion-body>
        ارسال اکسپرس تهران ۱-۲ روز کاری، سایر شهرها ۳-۴ روز کاری. امکان پرداخت در محل نداریم.
      </div>
      <div class="p-4 cursor-pointer flex items-center justify-between" data-accordion-toggle>
        <span class="font-semibold">بازگشت و گارانتی</span>
        <span>+</span>
      </div>
      <div class="p-4 text-sm text-slate-600 hidden" data-accordion-body>
        ۷ روز ضمانت بازگشت بی‌قید و شرط، تعویض رایگان در صورت معیوب بودن.
      </div>
    </div>
  </div>
</div>

<section class="mt-12">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-bold">محصولات مرتبط</h2>
    <a class="text-sm text-emerald-600" href="{% url 'shop:product_list' %}?category={{ product.category.slug }}">مشاهده همه</a>
  </div>
  <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
    {% for item in related %}
      {% include 'shop/includes/product_card.html' with product=item %}
    {% empty %}
      <p class="text-slate-500">محصول مرتبطی نیست.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}
